<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Member">

	<resultMap type="com.kh.with.member.model.vo.Member"
		id="memberResultSet">

		<id property="userNo" column="USER_NO" />
		<result property="userNm" column="USER_NM" />
		<result property="userId" column="USER_ID" />
		<result property="userPwd" column="USER_PWD" />
		<result property="nickname" column="NICKNAME" />
		<result property="phone" column="PHONE" />
		<result property="gender" column="GENDER" />
		<result property="adultYN" column="ADULT_YN" />
		<result property="chYN" column="CH_YN" />
		<result property="enrollDT" column="ENROLL_DT" />
		<result property="leaveDT" column="LEAVE_DT" />
		<result property="remainPT" column="REMAIN_PT" />
		<result property="status" column="STATUS" />
	</resultMap>

	<!-- 회원가입 -->
	<insert id="insertMember" parameterType="Member">
		INSERT INTO MEMBER
		VALUES(USER_NO.NEXTVAL, #{userNm}, #{userId}, #{userPwd},
		#{nickname},
		#{phone}, #{gender}, DEFAULT, DEFAULT, SYSDATE, NULL, 0, DEFAULT)
	</insert>

	<!-- 로그인 정보 조회용 쿼리 -->
	<select id="loginCheck" resultMap="memberResultSet" parameterType="Member">
		SELECT * 
		FROM MEMBER 
		WHERE USER_ID = #{userId} 
		AND USER_PWD = #{userPwd} 
		AND STATUS = 0
	</select>
	
	 <!-- 암호화된 비밀번호 조회용 메소드 -->
   <select id="selectPwd" parameterType="java.lang.String" resultType="java.lang.String">
      SELECT USER_PWD
      FROM MEMBER
      WHERE USER_ID = #{userId}
      AND STATUS = 0
   </select>
   
   <select id="selectLoginUser" parameterType="Member" resultMap="memberResultSet">
      SELECT *
      FROM MEMBER
      WHERE USER_ID = #{userId}
      AND STATUS = 0
   </select>
   	<!-- 회원정보수정 -->
	<update id="update_myPage()" parameterType="Member">
		UPDATE MEMBER 
		SET USER_NM = #{userNm}
		AND PHONE = #{phone}
		WHERE USER_ID = #{userId} 
	</update>
	
		<!-- 동영상 페이지 포인트 조회 -->
	<select id="selectPoint" parameterType="Member" resultType="int">
      SELECT REMAIN_PT
      FROM MEMBER
      WHERE USER_ID = #{userId}
      AND STATUS = 0
   </select>
	
	<!-- 포인트 후원금액 차감 -->
	<update id="regSub" parameterType="Member">
		UPDATE MEMBER
		SET REMAIN_PT = ${remainPT}
		WHERE USER_ID = #{userId}
		AND STATUS = 0
	</update>
</mapper>

